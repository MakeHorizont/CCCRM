# Архитектурный Манифест CCCRM (Этап "Антитезис")

## 1. Идеология Архитектуры
Мы строим не просто "бэкенд", а **Машину Истины**. 
Frontend может "лгать" (ошибки отображения, кэш), но Backend должен быть гранитным основанием фактов.

**Принципы:**
1.  **Диктатура Типов:** Строгая типизация на всех уровнях (TS в коде, SQL в БД). `any` запрещен как класс.
2.  **Стеклянные Стены:** Любое изменение критических данных (деньги, товары, права) оставляет неизменяемый след в `SystemEvent` (Audit Log).
3.  **Отчуждение Кода:** Логика расчетов (зарплаты, КТУ, склад) живет только на сервере. Клиент лишь отображает результат.
4.  **Примат Материи:** Нельзя создать запись о "продаже", если на складе физически нет товара. Нельзя начислить "премию", если в фонде нет денег.

## 2. Технологический Стек

### Ядро (Core)
*   **Framework:** **NestJS**. 
    *   *Почему:* Модульность (как цеха на заводе), строгая структура, Dependency Injection, отличная поддержка TypeScript.
*   **Language:** TypeScript 5.x.

### База Данных (Persistence)
*   **DBMS:** **PostgreSQL**.
    *   *Почему:* Надежность, ACID-транзакции, JSONB для гибких полей (настройки техкарт).
*   **ORM:** **Prisma**.
    *   *Почему:* Единый источник правды для схемы данных. Генерирует типы, которые мы можем шарить с фронтендом (Monorepo).

### Инфраструктура (Infrastructure)
*   **Containerization:** Docker & Docker Compose.
    *   *Принцип:* "Завод в коробке". Развертывание одной командой на любом сервере.

## 3. Структура Monorepo
Мы объединяем Фронт и Бэк в одном репозитории для синхронизации смыслов (типов).

```text
/
├── apps/
│   ├── client/       # Текущий React Frontend (наш "Тезис")
│   └── server/       # Будущий NestJS Backend ("Антитезис")
├── packages/
│   ├── types/        # Общие DTO и интерфейсы (Shared Truth)
│   └── config/       # Общие константы
├── documents/        # Конституция проекта
└── docker-compose.yml
```

## 4. Безопасность и Власть
*   **JWT Auth:** Stateless аутентификация.
*   **RBAC (Role-Based Access Control):**
    *   Роли: `Worker`, `Manager`, `CEO`.
    *   Гварды (Guards) на каждом эндпоинте.
*   **Dual Key Protocol:** Для критических действий (изменение `FundSettings`) эндпоинт требует цифровой подписи (токена одобрения) от Совета.
